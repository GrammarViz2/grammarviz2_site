<!DOCTYPE html>
<html>
<head>
  <title> Time series recurrent pattern (motif) discovery using GrammarViz 2.0 CLI | GrammarViz 2.0 </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!--  Load bootswatch-based Morea theme file. -->
  <link rel="stylesheet" href="/grammarviz2_site/css/themes/flatly/bootstrap.min.css">
  <link rel="stylesheet" href="/grammarviz2_site/css/style.css">
  <link rel="stylesheet" href="/grammarviz2_site/css/syntax.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:normal,italic,bold">
  <link rel="shortcut icon" href="/grammarviz2_site/favicon.ico" type="image/x-icon" />

  <!--  Load LaTeX processing stuff. -->
  <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <!--  Google check-up. -->
  <meta name="google-site-verification" content="IPRp9YV-GjZISFj5du9xbjjiTWKkc9Rpwb3_md6PIe8" />
  <link rel="alternate" href="http://example.com/en" hreflang="en" />

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.2.0/respond.js"></script>
  <![endif]-->

  <!-- Load Bootstrap JavaScript components -->
  <!-- <script src="http://code.jquery.com/jquery.min.js"></script> -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</head>
<body>
<!-- Responsive navbar -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <!--  Display three horizontal lines when navbar collapsed. -->
        <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/grammarviz2_site/index.html"> GrammarViz 2.0 </a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/grammarviz2_site/modules/">Modules</a></li>
        <!--  -->
        
          <li><a href="/grammarviz2_site/readings/">Readings</a></li>
        
        
          <li><a href="/grammarviz2_site/experiences/">Experiences</a></li>
        
        <!--  -->
      </ul>
    </div>
  </div>
</div>


<div class="container">
  <h2 id="recurrent-patterns-discovery-with-grammarviz-20-and-command-line">Recurrent patterns discovery with GrammarViz 2.0 and command line</h2>

<h3 id="introduction">1. Introduction</h3>
<p>We discuss same as in GUI tutorial use-cases which show GrammarViz utility in variable length time series pattern discovery.</p>

<h3 id="dataset-used">2. Dataset used</h3>
<p>Two datasets are used in this demo:</p>

<h4 id="winding-dataset">2.1. Winding dataset</h4>
<p>According to the <a href="ftp://ftp.esat.kuleuven.ac.be/pub/SISTA/data/process_industry/winding.txt">original dataset source</a> this <a href="https://jmotif.googlecode.com/svn/trunk/data/demo/winding.dat.gz">dataset</a> is a snapshot of data collected from industrial winding process whose column #2 corresponds to traction reel angular speed:</p>

<div class="container">
  <div class="row">
    <div class="col-sm-8">
      <img style="margin-top: 5px; margin-bottom: 5px" src="../assets/winding_col2.png" width="800px" class="img-responsive center-block" />
    </div>
  </div>
</div>

<p>unfortunately, we do not know any specific information about this dataset.</p>

<h4 id="qtdb-0606-ecg-dataset">2.2. QTDB 0606 ECG dataset</h4>
<p>This data set (database record) can be downloaded from <a href="http://physionet.org/physiobank/database/qtdb/">PHYSIONET FTP</a> and converted into the text format by executing this command</p>
<pre>
rdsamp -r sele0606 -f 120.000 -l 60.000 -p -c | sed -n '701,3000p' &gt;0606.csv
</pre>
<p>in the linux shell (assuming that you have rdsamp installed at your system).
We use the second column of this file. This is our dataset overview:</p>

<div class="container">
  <div class="row">
    <div class="col-sm-8">
      <img style="margin-top: 5px; margin-bottom: 5px" src="../assets/qtdb0606.png" width="800px" class="img-responsive center-block" />
    </div>
  </div>
</div>

<p>We know, that the third heartbeat of this ECG dataset contains the true anomaly as it was discussed in <a href="http://www.cs.gmu.edu/~jessica/publications/discord_icdm05.pdf">HOTSAX paper by Eamonn Keogh, Jessica Lin, and Ada Fu</a>. Note, that the authors were specifically interested in finding anomalies which are shorter than a regular heartbeat following a suggestion given by the domain expert: “<em>… We conferred with cardiologist, Dr. Helga Van Herle M.D., who informed us that heart irregularities can sometimes manifest themselves at scales significantly shorter than a single heartbeat….</em>”
Figure 13 of the paper further explains the nature of this true anomaly:</p>

<div class="container">
  <div class="row">
    <div class="col-sm-8">
      <img style="margin-top: 5px; margin-bottom: 5px" src="../assets/demo-ecg0606_cluster.png" width="400px" class="img-responsive center-block" />
    </div>
  </div>
</div>

<h3 id="using-cli">3. Using CLI.</h3>
<p>By following the build instructions from our source code repository you can build a stand-alone jar file which we are going to use. It is named as <code>grammarviz2-X.X.X-SNAPSHOT-jar-with-dependencies.jar</code> where <code>X.X.X</code> is the latest release version. For this tutorial I have used the version tagged with
<a href="https://github.com/GrammarViz2/grammarviz2_src/releases/tag/cli_pre-release"><code>cli_pre-release</code></a> tag which you can checkout from repo by running <code>$ git checkout cli_pre-release</code>.</p>

<p>Running the jar as usual, i.e., <code>java -jar ...</code> runs GUI, thus we must specify a specific class name (the one implementing the CLI interface). If run without parameters, this will print a short help message:</p>

<pre>

$ java -cp "target/grammarviz2-0.0.1-SNAPSHOT-jar-with-dependencies.jar" net.seninp.grammarviz.cli.TS2SequiturGrammar
Usage: &lt;'main class'&gt; [options] 
  Options:
    --alphabet_size, -a
       SAX alphabet size
       Default: 4
    --data_in, -d
       The input file name
    --data_out, -o
       The output file name
    --help, -h
       Default: false
    --strategy
       Numerosity reduction strategy
       Default: NONE
       Possible Values: [NONE, EXACT, MINDIST]
    --threshold
       Normalization threshold
       Default: 0.01
    --window_size, -w
       Sliding window size
       Default: 30
    --word_size, -p
       PAA word size
       Default: 6
       
</pre>

<h3 id="variable-length-recurrent-patterns-discovery">4. Variable length recurrent patterns discovery</h3>
<p>We use winding dataset in this tutorial with parameters of sliding window 100, PAA size 4 , alphabet size 3, and EXACT numerosity reduction strategy:</p>

<pre>

$ java -cp "target/grammarviz2-0.0.1-SNAPSHOT-jar-with-dependencies.jar" net.seninp.grammarviz.cli.TS2SequiturGrammar -d data/winding_col.txt -o winding_grammar.txt -w 100 -p 4 -a 3 --strategy EXACT
GrammarViz2 CLI converter v.1
parameters:
  input file:                  data/winding_col.txt
  output file:                 winding_grammar.txt
  SAX sliding window size:     100
  SAX PAA size:                4
  SAX alphabet size:           3
  SAX numerosity reduction:    EXACT
  SAX normalization threshold: 0.01


14:19:28.906 [main] INFO  n.s.g.cli.TS2SequiturGrammar - Reading data ...
14:19:29.102 [main] INFO  n.s.g.cli.TS2SequiturGrammar - read 2500 points from null
14:19:29.102 [main] INFO  n.s.g.cli.TS2SequiturGrammar - Performing SAX conversion ...
14:19:29.198 [main] INFO  n.s.g.cli.TS2SequiturGrammar - Inferring Sequitur grammar ...
14:19:29.309 [main] INFO  n.s.g.cli.TS2SequiturGrammar - Collecting stats ...
14:19:29.320 [main] INFO  n.s.g.cli.TS2SequiturGrammar - Producing the output ...

</pre>

<p>This will yield a file named <code>winding_grammar.txt</code> containing the inferred grammar description and corresponding to its rules subsequences.</p>

<p>The rule #29 description from this file demonstrates the algorithm’s ability to capture repeated patterns of a length much larger than the original sliding window size. The subsequences corresponding to this rule are of length 354 and 353:</p>

<pre>
...
/// R29
R29 -&gt; 'R50 abbc abcc abcb R6 R46 R8 R13 R4 cacb R45 R52 R6 R16 bcba R20 R1 R2 acbb acba acbb', expanded rule string: 'bbac bbbc abbc abcc abcb bbcb bbca bcca bcba bcbb bcab ccab cbab cbac caac caab cbab cbbb cabb cacb bacb bbcb bbbb bbbc abbc acbc acbb abbb bbbb bbcb bbca cbca cbba bbba bcba ccaa cbaa cbab cbac caac baac babc babb bacb bbcb bbbb abbb acbb acba acbb '
subsequences starts: [806, 1806]
subsequences lengths: [354, 353]
rule occurrence frequency 2
rule use frequency 2
min length 353
max length 354
mean length 353
...
</pre>

<p>at the same time, the subsequences corresponding to the most frequent rule #8 vary in length between 102 and 121 points:</p>

<pre>
...
/// R8
R8 -&gt; 'bcbb bcab', expanded rule string: 'bcbb bcab '
subsequences starts: [61, 115, 341, 565, 640, 852, 1565, 1640, 1853, 2060, 2341]
subsequences lengths: [102, 103, 121, 109, 107, 114, 109, 108, 113, 103, 120]
rule occurrence frequency 11
rule use frequency 5
min length 102
max length 121
mean length 109
...
</pre>

<p>Similarly, if we use <code>qtdb0606</code> dataset with SAX discretization parameters set to sliding window 100, PAA 8, and alphabet 4 (<code>java -cp "target/grammarviz2-0.0.1-SNAPSHOT-jar-with-dependencies.jar" net.seninp.grammarviz.cli.TS2SequiturGrammar -d data/ecg0606_1.csv -o ecg_grammar.txt -w 100 -p 8 -a 4 --strategy EXACT</code>), the algorithm finds that the most frequently occurring rules are normal heartbeats ranging in length from 105 to 107 points:</p>

<pre>
...
/// R6
R6 -&gt; 'bbcbbdab bbcbcdab', expanded rule string: 'bbcbbdab bbcbcdab '
subsequences starts: [62, 209, 506, 652, 798, 943, 1087, 1234, 1384, 1533, 1682, 1828, 1973, 2115]
subsequences lengths: [105, 107, 107, 105, 107, 106, 106, 106, 106, 107, 106, 107, 107, 107]
rule occurrence frequency 14
rule use frequency 4
min length 105
max length 107
mean length 106
...
</pre>

<h2 id="discussion">5. Discussion</h2>
<p>Note, that due to two factors: the numerosity reduction embedded in the data discretization process and the nature of GI algorithms, that create rules based on the long-range correlations, the shown above recurrent pattern discovery technique yields sets of frequent subsequences of a <em>variable length</em>.</p>

</div>



<div class="footer-background">
<footer>
  <div class="container page-footer">
    
      <p>Continuous Integration:&nbsp;&nbsp; <a href="https://travis-ci.org/GrammarViz2/grammarviz2_src"><img src="https://travis-ci.org/GrammarViz2/grammarviz2_src.svg?branch=master" /> (master)</a></p>
<p>Contact: <a href="http://www2.hawaii.edu/~senin">Pavel Senin,</a> <a href="mailto:#">seninp@gmail.com</a><br /></p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54135903-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10360660; 
var sc_invisible=1; 
var sc_security="391036a7"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>

<noscript><div class="statcounter"><a title="shopify site
analytics" href="http://statcounter.com/shopify/" target="_blank"><img class="statcounter" src="http://c.statcounter.com/10360660/0/391036a7/1/" alt="shopify site analytics" /></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

    
    <p style="margin: 0">Powered by the <a href="http://morea-framework.github.io/">Morea Framework</a> (Theme: flatly)<br>
       Last update on: <span>2015-06-19 08:41:06 +0200</span></p>
    <p style="margin: 0">
      2 modules
      <!--  -->
      
        | 3 readings
      
      
        | 4 experiences
      
      <!--  -->
    </p>
  </div>
</footer>
</div>
</body>
</html>
